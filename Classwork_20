import time
from selenium import webdriver
from selenium.webdriver.common.by import By
from pytest_check import check
import allure

URL = "https://slqamsk.github.io/cases/pizza/v08"

@allure.title("1. Проверка заголовков")
def test_titles():
    dr = webdriver.Chrome()

    with allure.step("Открыть страницу"):
        dr.get(URL)

    with check:
        with allure.step("Проверить заголовок страницы"):
            assert dr.title == "Пиццерия - Оформление заказа"

    with check:
        with allure.step("Проверить заголовок на странице"):
            el = dr.find_element(By.XPATH, "//h1")
            assert el.text == "Пиццерия \"Итальянский уголок\""

@allure.title("Проверка заказа пиццы")
def test_order_base_pizza():
   with allure.step("Открытие страницы"):
        dr = webdriver.Chrome()
        dr.get(URL)

   with allure.step("Поиск и добавление пиццы в заказ"):
        element_1 = dr.find_element(By.XPATH, "//h3[.='Маргарита']/parent::*//child::button")
        element_1.click()
        time.sleep(1)
        element_2 = dr.find_element(By.XPATH, "//h3[.='Четыре сыра']/parent::*//child::button")
        element_2.click()
        time.sleep(1)
        element_3 = dr.find_element(By.XPATH, "//h3[.='Вегетарианская']/parent::*//child::button")
        element_3.click()

    with allure.step("Переход в корзину"):
        dr.find_element(By.XPATH, "//a[@class='cart-link']").click()
        time.sleep(2)
    with allure.step("Оформление заказа"):
        dr.find_element(By.XPATH, "//button[@id='place-order']").click()
        time.sleep(2)
    with allure.step("Ввод данных покупателя"):
        dr.find_element(By.XPATH, "//input[@id='customer-name']").send_keys("Дмитрий Андреевич")
        dr.find_element(By.XPATH, "//input[@id='customer-email']").send_keys("rpaqp@mail.ru")
        dr.find_element(By.XPATH, "//button[@id='confirm-order']").click()
        time.sleep(2)

    with check:
        with allure.step("Проверка отображения имени и фамилии клиента"):
        order = dr.find_element(By.XPATH, "//div[@id='order-info']")
        assert "Дмитрий Андреевич" in order.text

    with check:
        with allure.step("Проверка отображения почты клиента"):
        assert "rpaqp@mail.ru" in order.text

    with check:
        with allure.step("Проверка состава заказа"):
        assert "Вегетарианская" and "Четыре сыра" and "Маргарита" in order.text

    with check:
        with allure.step("Проверка присвоения номера заказа"):
        assert "Номер заказа:" in order.text
